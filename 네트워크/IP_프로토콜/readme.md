# IP 프로토콜

### 라우팅

네트워크의 구성 형태에 대한 정보는 **라우팅 테이블**이라는 기억 장소에 보관된다. 그리고 이 정보를 이용해 패킷이 목적지까지 도달하기 위한 경로를 선택한다. 송수신 호스트 사아의 패킷 전달 경로를 선택하는 과정을 라우팅이라 하고, 라우팅 테이블 정보는 네트워크 관리자나 네트워크 자신의 판단에 의해 계속 변경될 수 있다.

### 패킷의 분할과 병합

상위 전송 계층에서 송신을 요구한 데이터는 최종적으로 MAC 계층의 프레임 구조에 정의된 형식으로 캡슐화되어 물리적으로 전송된다. 따라서 전송 계층에서 보낸 데이터가 너무 크면 여러 개의 패킷으로 작게 쪼개 전송해야 한다. 이와 같이 큰 데이터를 여러 패킷으로 나누는 과정을 **패킷 분할**이라 하고, 반대로 목적지에서 분할된 패킷을 다시 모으는 과정을 **병합**이라 한다.

### 연결형 서비스와 비 연결형 서비스

![Untitled](IP%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%90%E1%85%A9%E1%84%8F%2049775/Untitled.png)

**비 연결형 서비스**

패킷의 전달 순서, 패킷 분실 여부 등에서 연결형 서비스보다 신뢰성이 떨어지는 전송 방식 따라서 자체적으로 오류 제어와 흐름 제어 기능을 더 많이 수행해야 한다. 

패킷이 서로 다른 경로를 통해 목적지 호스트로 전달되기 때문이 패킷이 도착하는 순서가 일정하지 않아 상위 계층인 전송 계층은 패킷의 순서를 재조정하는 기능이 필요하다.

**연결형 서비스**

신뢰성이 높은 서비스로 패킷을 전송하기 전에 연결을 미리 설정하여 송신하는 방법이다. 패킷의 순서가 송신된 순서와 동일하다.

**라우팅**

네트워크 계층의 가장 중요한 역할

1 **정적 라우팅**

송수신 호스트 사이에서 패킷 전송이 이루어지기 전에 경로 정보를 라우터에 미리 저장하여 중개하는 방식이다.

**단점 :** 

운용 중 네트워크 구성에 변화가 생기면 이에 적절한 대처 X

경로 정보가 고정 되어 있으므로 변화된 정보 갱신이 어려우며 네트워크 혼잡도를 반영할 수 없다.

 

2 **동적 라우팅**

라우터에서 사용하는 경로 정보를 네트워크 상황에 따라 절절하게 변경하는 방식으로 경로 정보의 변경 주기에 따라 계속 보완할 수 있다.

**단점 :**

경로 정보 수집과 관리로인한 성능 저하

### HELLO/ECHO 패킷

라우터 초기화 과정에서 가장 먼저 라우터의 경로 정보를 파악한다. 라우터는 이웃에 연결된 라우터에 초기화를 위한 HELLO 패킷을 전송해 경로 정보를 얻는다.

라우터 사이의 전송 지연시간을 측정하기 위해서 ECHO 패킷을 전송하는데 ECHO 패킷을 수신한 호스트는 송신 호스트에 즉각 회신하도록 설계되어 있다.

 이런 과정을 반복하고 측정값의 평균을 구해 해당 라우터까지의 전송 지연 시간을 유추할 수 있다.

### 라우팅 테이블

패킷 전송 과정에서 라우터들이 적절한 경로를 쉽게 찾도록 하기 위한 가장 기본적인 도구로 포함하는 필수 정보는 (**목적지 호스트, 다음 홉**)의 조합이다. '목적지 호스트'에는 패킷의 최종 목적지가 되는 호스트의 주소값을, ''다음 홉'에는 목적지 호스트까지 패킷을 전달하기 위한 이웃 라우터를 지정한다.

![Untitled](IP%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%90%E1%85%A9%E1%84%8F%2049775/Untitled%201.png)

**라우팅 정보의 처리**

라우팅을 효과적으로 수행하려면 라우팅 정보가 네트워크의 현재 상황을 정확히 반영활 수 있도록 관리해야한다. 

**1 소스 라우팅**

패킷을 전송하는 호스트가 목적지 호스트까지 전달 경로를 스스로 결정하는 방식을 **소스 라우팅**이라 한다. 소스 라우팅을 지원하려면 **송신 호스트의 라우팅 테이블에서 패킷을 수신 호스트까지 전달하기 위한 경로 정보를 관리해야 하며 이러한 경로 정보를 전송 패킷에 기록해야 한다.** 모든 라우팅 정보를 송신 호스트가 관리하므로 중간에 있는 라우터 들은 라우팅 테이블을 관리할 필요가 없다.

**2 분산 라우팅**

라우팅 정보가 분산되는 방식으로 패킷의 전송 경로에 위치한 각 라우터가 효율적인 경로 선택에 참여한다. 분산 라우팅은 데이터그램 방식에서 많이 사용한다. 이 방식의 장점은 네트워크에 존재하는 호스트의 수가 많아질수록 다른 방식에 비해 효과적일 수 있다. 라우터가 관리하는 경로 정보는 네트워크 상황에 따라 적절이 변경한다는 동적 특징이 있다.

**3 중앙 라우팅** 

RCC(Routing Control Center)라는 특별한 호스트를 사용해 전송 경로에 관한 모든 정보를 관리하는 방식이다. 패킷 전송을 원하는 송신 호스트는 반드시 RCC로 부터 목적지 호스트까지 도착하기 위한 경로 정보를 미리 얻어야 한다.

이 정보를 이용해 송신 호스트는 소스 라우팅과 동일한 원리로 패킷을 전송한다.

장점 : 경로 정보를 특정 호스트가 관리하므로 일반 호스트가 정보 관리를 할 부담을 줄일 수 있다.

단점 : 네트워크 규모가 커짐에 따라 RCC에 과도한 트래픽을 주어 전체 효율이 떨어질 수 있다.

**4 계층 라우팅**

분산 라우팅 기능과 중앙 라우팅 기능을 적절히 조합하는 방식으로 전체 네트워크의 구성을 계층 구조 형태로 관리한다. 일반적으로 네트워크 규모가 계속 커지는 환경에 효과적이다.

### 라우팅 프로토콜

**최단 경로 라우팅(OSPF)**

패킷이 목적지에 도달할 때까지 거치는 라우터 수가 최소화 될 수 있도록 경로를 선택한다. 비교적 간단한 형식으로 쉽게 적용할 수 있다. 전송 경로 패킷이 목적지까지 도착하는 여러 경로 중 가장 짧은 경로를 선택한다.

거리 기준 : 홉, 패킷의 전송 지연 시간, 전송 대역폭, 통신 비용

**1 거리 벡터 라우팅 프로토콜**

자신과 직접 연결된 이웃 라우터와 라우팅 정보를 교환하는 방식이다. 정보를 교환하는 라우터는 거리 벡터 프로토콜을 사용하는 호스트나 라우터들이다. **교환 정보는 각각의 라우터에서 전체 네트워크에 소속되는 개별 네트워크까지 패킷을 전송하는 데 걸리는 거리 정보이다**. RIP 프로토콜에서 사용 

구현하기 위해서는 라우터가 

**링크 벡터 : 이웃 네트워크에 대한 연결 정보**

**거리 벡터 : 개별 네트워크까지의 거리 정보**

**다음 홉 벡터 : 개별 네트워크로 가기 위한 다음 홉 정보**

**2 링크 상태 라우팅 프로토콜**

정보 교환 원리가 거리 벡터 방식과 반대이다.

개별 라우터가 이웃 라우터까지의 거리 정보를 구한 후 이를 네트워크에 연결된 모든 라우터에 통보한다. TCP/IP 기반의 인터넷에서 사용하는 OSPF가 있다.

거리 벡터는 각 라우터가 상당한 양의 정보 전송을 요구받고 링크 상태가 변하면 동작 과정에서 시간이 많이 소요되므로 그 단점을 보환하기 위한 방식

거리 벡터 프로토콜 : 정보가 주기적으로 전달.

링크 상태 프로토콜 : 이웃 라우터와 연결된 상황에 변화가 있을 때만 정보 전달.

![Untitled](IP%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%90%E1%85%A9%E1%84%8F%2049775/Untitled%202.png)

![Untitled](IP%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%90%E1%85%A9%E1%84%8F%2049775/Untitled%203.png)

**3 외부 라우팅 프로토콜** 

AS 간의 라우팅 즉 게이트웨의 간의 라우팅에 사용되는 프로토콜

![Untitled](IP%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%90%E1%85%A9%E1%84%8F%2049775/Untitled%204.png)

**EGP :** 다른 그룹과 라우팅 정보를 교환하는 프로토콜, 시스템 사이에 경로 설정 정보 등을 교환하기 위해 사용하는 프로토콜

**BGP :** EGP 보다 업그레이드 된 외부 라우팅 프로토콜 초기 연결시에 전체 경로 테이블을 교환하고 이후  변동 내역이 있을 때만 변동 내역 교환